USE MASTER
GO

DROP DATABASE IF EXISTS FPL_DaoTao
CREATE DATABASE FPL_DAOTAO
GO

USE FPL_DaoTao
GO

DROP TABLE IF EXISTS USERS
CREATE TABLE USERS (
	USERNAME VARCHAR(30) PRIMARY KEY,
	[PASSWORD] NVARCHAR(12) NOT NULL,
	[ROLE] NVARCHAR(10) NOT NULL
);

DROP TABLE IF EXISTS STUDENTS
CREATE TABLE STUDENTS (
	MASV NVARCHAR(7) PRIMARY KEY,
	[NAME] NVARCHAR(50) NULL,
	EMAIL NVARCHAR(30) NULL,
	PHONE VARCHAR(10) NULL,
	GENDER BIT NULL,
	[ADDRESS] NVARCHAR(50) NULL,
	HINH NVARCHAR(30) NULL
);

truncate table students

DROP TABLE IF EXISTS GRADES
CREATE TABLE GRADES (
	MASV NVARCHAR(7) PRIMARY KEY,
	ENGLISHSCORE FLOAT NULL,
	ITSCORE FLOAT NULL,
	PESCORE FLOAT NULL,
	AVGSCORE FLOAT NULL

	CONSTRAINT PK_GRADES_MASV FOREIGN KEY (MASV) REFERENCES STUDENTS(MASV)
);

INSERT INTO USERS VALUES 
	('SV12345', '123456','STUDENT'),
	('GV12345', '123456','TEACHER'),
	('DT12345', '123456','MANAGER'),
	('SV23577', '123456','STUDENT')

INSERT INTO STUDENTS VALUES
	('SV23577', N'Tô Hoàng Tuấn', 'tuanthps23577@fpt.edu.vn', '0908303686', 0, 'TPHCM', null),
	('SV10001', N'Nguyễn Tri Phương', null, '0904412421', 0, 'Q4', null),
	('SV10002', N'Phạm Nhật Vượng', null, '0396114174', 0, 'Q2', null),
	('SV10003', N'Lê Bảo Ngọc', null, '0373390734', 1, 'Q7', null),
	('SV10004', N'Nguyễn Thị Ánh', null, '0363634911', 1, 'Q9', null),
	('SV10005', N'Đỗ Ngọc Trâm', null, '0540738888', 1, 'Q12', null),
	('GV12345', N'Trần Quang Bình', 'binhtqgv12345@fpt.edu.vn', '0909112233', 0, N'Gò Vấp', null),
	('DT12345', N'Lê Quản Lý', 'lylq@fpt.edu.vn', '0909123321', 1, N'Quận 1', null)

INSERT INTO GRADES VALUES
	('SV23577', 7.0, 10.0, 4.0, 7.0),
	('SV10001', 6.5, 7.1, 8.9, null),
	('SV10002', 5.6, 2.3, 9.8, null),
	('SV10003', 4.0, 4.7, 6.4, null),
	('SV10004', 8.5, 3.3, 4.6, null),
	('SV10005', 10, 3.0, 9.7, null)

SELECT * FROM USERS
SELECT * FROM GRADES
SELECT * FROM STUDENTS

GO

DROP PROC IF EXISTS FIND_ACCOUNT
GO
CREATE PROC FIND_ACCOUNT
AS  
BEGIN
  SELECT USERS.*, EMAIL FROM USERS
  INNER JOIN STUDENTS ON MASV LIKE USERNAME
  RETURN;
END

DROP FUNCTION IF EXISTS SCORES_INFO
GO
CREATE FUNCTION SCORES_INFO () 
	RETURNS TABLE
RETURN (
	SELECT GRADES.MASV, [NAME], ENGLISHSCORE, ITSCORE, PESCORE, AVGSCORE FROM GRADES
  INNER JOIN STUDENTS ON STUDENTS.MASV LIKE GRADES.MASV
)
GO